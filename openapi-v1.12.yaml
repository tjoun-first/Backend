openapi: 3.0.3
info:
  title: NewsMoa Backend API
  description: |
    NewsMoa Backend 서비스의 API 명세서입니다.
    기사 조회, 로그인, 마이페이지 기능을 제공합니다.
  version: 1.12.0
servers:
  - url: /api
    description: 기본 API 서버

paths:
  /login:
    post:
      summary: 로그인 API
      description: 입력한 ID와 PW로 로그인합니다.
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 로그인 성공
        '400':
          description: 잘못된 요청 형식
        '401':
          description: 로그인 실패
          
  /logout:
    get:
      summary: 로그아웃
      description: 로그아웃합니다.
      operationId: logout
      responses: 
        '200':
          description: 로그아웃 성공
          
  /users:
    post:
      summary: 회원가입
      description: 신규 사용자를 등록합니다.
      tags:
        - User
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
                - password
              properties:
                id:
                  type: string
                  example: user123
                password:
                  type: string
                  example: 1234
      responses:
        "201":
          description: 회원가입 성공
        "400":
          description: 입력값 오류
        "409":
          description: 아이디 중복

  /users/exists:
    get:
      summary: 아이디 중복 체크
      description: 입력한 로그인 아이디의 중복 여부를 확인합니다.
      tags:
        - User
      parameters:
        - name: loginId
          in: query
          required: true
          description: 중복 확인할 로그인 ID
          schema:
            type: string
            example: user123
      responses:
        "200":
          description: 조회 성공
        "400":
          description: 요청 파라미터 누락
  
  
  /article/{category}:
    get:
      summary: 기사 목록 조회
      description: 입력한 카테고리에 해당하는 기사들의 목록(title, id 등)을 반환합니다. content, simplified, summary는 null일 수 있습니다.
      tags:
        - Article
      operationId: getArticlesByCategory
      parameters:
        - name: category
          in: path
          description: 한글로 된 기사 카테고리 이름 (경제, 과학, 사회, 세계, 문화)
          required: true
          schema:
            type: string
            enum:
              - 경제
              - 과학
              - 사회
              - 세계
              - 문화
      responses:
        '200':
          description: 기사 목록 반환 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Article'

  /article/id/{article_id}:
    get:
      summary: 기사 세부정보 조회
      description: 요청한 article_id의 모든 상세 정보를 반환합니다.
      tags:
        - Article
      operationId: getArticleDetail
      parameters:
        - name: article_id
          in: path
          description: 조회할 기사 ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 기사 세부 정보 반환 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Article'
        '400':
          description: 잘못된 article_id 입력
  
  /article/search:
    get:
      summary: 기사 제목 검색
      description: 요청한 keyword와 유사한 제목을 가진 기사의 리스트를 반환합니다.
      tags:
        - Article
      operationId: searchByKeyword
      parameters:
        - name: keyword
          in: query
          description: 검색에 사용할 키워드
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 기사 리스트 반환 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Article'
  
  /article/recommand:
    get:
      summary: 기사 추천
      description: 조회수 기반으로 5개의 추천 기사를 반환합니다.
      tags:
        - Article
      operationId: recommandArticle
      responses:
        '200':
          description: 추천 기사 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Article'

  /article/{article_id}/comment:
    get:
      summary: 기사 댓글 조회
      description: 요청한 article_id에 대한 댓글 목록을 반환합니다.
      tags:
        - Article
      operationId: getArticleComments
      parameters:
        - name: article_id
          in: path
          description: 댓글을 조회할 기사 ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 댓글 목록 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'
    post:
      summary: 기사 댓글 작성
      description: 요청한 article_id에 대한 댓글을 작성합니다.
      tags:
        - Article
      operationId: createArticleComment
      parameters:
        - name: article_id
          in: path
          description: 댓글을 작성할 기사 ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 댓글 작성 성공
  
  /comment/{parentCommentId}/reply:
    post:
      summary: 대댓글 작성
      description: 요청한 parentCommentId에 대한 대댓글을 작성합니다.
      tags:
        - Article
      operationId: createReplyComment
      parameters:
        - name: parentCommentId
          in: path
          description: 대댓글을 작성할 부모 댓글 ID
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReplyRequest'
      responses:
        '200':
          description: 대댓글 작성 성공
  
  
  
  /mypage/scraped:
    get:
      summary: 마이페이지 - 스크랩한 기사 목록
      description: 요청한 유저가 스크랩한 기사 리스트를 반환합니다. (세션 기반 인증)
      tags:
        - Mypage
      operationId: getScrapedArticles
      responses:
        '200':
          description: 스크랩 기사 목록 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Article'
    put:
      summary: 기사 스크랩하기
      description: 요청한 유저의 스크랩 목록에 기사를 추가합니다. (세션 기반 인증)
      tags:
        - Mypage
      operationId: addScrapedArticles
      parameters:
        - name: article_id
          in: query
          description: 추가할 기사 id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 스크랩 성공
    delete:
      summary: 마이페이지 - 스크랩한 기사 삭제
      description: 요청한 유저가 스크랩한 기사를 삭제합니다. 스크랩 목록에 해당 기사가 없다면 아무것도 하지 않습니다. (세션 기반 인증)
      tags:
        - Mypage
      operationId: deleteScrapedArticles
      parameters:
        - name: article_id
          in: query
          description: 삭제할 기사 id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 삭제 성공

  /mypage/recent:
    get:
      summary: 마이페이지 - 최근 본 기사 목록
      description: 요청한 유저가 최근에 본 기사 리스트를 반환합니다.
      tags:
        - Mypage
      operationId: getRecentArticles
      responses:
        '200':
          description: 최근 본 기사 목록 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Article'
  
  /util/word-meaning:
    get:
      summary: 단어의 의미 질문
      description: 문장 내에서 단어의 의미를 gemini에게 질문합니다.
      tags:
        - Util
      operationId: getWordMeaning
      parameters:
        - name: word
          in: query
          description: 질문할 단어
          required: true
          schema:
            type: string
        - name: sentence
          in: query
          description: 단어의 맥락 이해를 위해 해당 단어가 포함된 문장 전체
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 문장 내에서 단어의 의미에 대한 설명 반환
          content:
            text/plain:
              schema:
                type: string
                example: "이 문장에서 해당 단어는 별 의미가 없을 확률이 높습니다. 무시하셔도 됩니다."

components:
  schemas:
    LoginRequest:
      type: object
      properties:
        id:
          type: string
          description: 사용자 ID
          example: "testuser"
        password:
          type: string
          description: 사용자 비밀번호
          example: "testpw"
      required:
        - id
        - password

    Article:
      type: object
      description: 기사 정보 DTO
      properties:
        id:
          type: integer
          description: 기사 고유 ID
          example: 12
        category:
          type: string
          description: 기사 카테고리
          example: "politics"
        date:
          type: string
          format: date
          description: 기사 작성일 (YYYY-MM-DD)
          example: "2024-01-02"
        url:
          type: string
          description: 원본 기사 URL
          example: "https://news.example.com/12"
        img:
          type: string
          example: "https://img.example.com/10"
        title:
          type: string
          description: 기사 제목
          example: "정부, 새로운 정책 발표"
        content:
          type: string
          nullable: true
          description: 기사 원문
        simplified:
          type: string
          nullable: true
          description: AI 해석본
          example: "정부가 새로운 정책을 발표했습니다. 주요 내용은..."
        summary:
          type: string
          nullable: true
          description: AI 요약본
          example: "정부는 오늘 새로운 정책을 발표했다."
        isScraped:
          type: boolean
          nullable: false
          description: 기사를 요청한 유저가 이 기사를 스크랩했는지 여부
    Comment:
      type: object
      description: |
        단일 댓글 객체입니다. 
        대댓글(children)을 포함하여 재귀적인 구조를 가집니다.
      properties:
        commentId:
          type: integer
          format: int64
          description: 댓글의 고유 ID
          example: 3
        articleId:
          type: integer
          format: int64
          description: 이 댓글이 속한 기사의 ID
          example: 1
        userId:
          type: string
          description: 작성자 ID
          example: "user01"
        content:
          type: string
          description: 댓글 내용
          example: "첫 번째 최상위 댓글입니다. (Parent 1)"
        status:
          type: string
          description: 댓글 상태 (approved, pending, reported 중 하나)
          enum:
            - approved
            - pending
            - reported
          example: "approved"
        likeCount:
          type: integer
          format: int32
          description: 받은 좋아요 수
          example: 5
        createdAt:
          type: string
          format: date-time
          description: 댓글 작성 시간
          example: "2025-12-11T21:37:28"
        updatedAt:
          type: string
          format: date-time
          description: 댓글 최종 수정 시간
          example: "2025-12-11T21:37:28"
        parentCommentId:
          type: integer
          format: int64
          nullable: true
          description: |
            부모 댓글의 ID. 
            최상위 댓글일 경우 null.
          example: null
        children:
          type: array
          description: 이 댓글에 달린 대댓글 목록입니다.
          items:
            $ref: '#/components/schemas/Comment'
    ReplyRequest:
      type: object
      description: 대댓글 작성 요청 DTO
      properties:
        content:
          type: string
          description: 대댓글 내용
          example: "이것은 대댓글입니다."
        userId:
          type: string
          description: 작성자 ID
          example: "user123"
        status:
          type: string
          description: 댓글 상태
          enum:
            - approved
            - pending
            - reported
          example: "approved"
      required:
        - content